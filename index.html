<!DOCTYPE html>
<html>
    <head>
        <script src="bower_components/react/react.js"></script>
        <script src="bower_components/react/JSXTransformer.js"></script>
        <link  href="bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <div id="container"></div>


        <script type="text/jsx">
        /** @jsx React.DOM */

        var EpisodeRow = React.createClass({
            getInitialState: function() {
                return {
                    viewed: false
                };
            },
            handleClick: function(){
              this.setState({viewed: true});
            },
            render: function() {
                return (
                    <tr>
                        <td>{this.props.episode.title}</td>
                        <td><a  onClick={this.handleClick}>view {this.state.viewed ? '(viewed)' : ''}</a></td>
                    </tr>
                );
            }
        });

        var EpisodeTable = React.createClass({
            render: function() {
              var props = this.props;
              var rows = props.episodes
                .filter(function(episode){
                  return episode.title.toLowerCase().indexOf(props.filterText.toLowerCase()) > -1;
                })
                .map(function(episode){
                  return <EpisodeRow key={episode.title} episode={episode} />;
                });


              return (
                  <div className="row spacer">
                    <div className="col-lg-4 col-lg-offset-4">
                      <table width="100%">
                          <thead>
                              <tr>
                                  <th>Title</th>
                                  <th>Link</th>
                              </tr>
                          </thead>
                          <tbody>{rows}</tbody>
                      </table>
                    </div>
                  </div>
              );
            }
        });

        var SearchBar = React.createClass({
            handleChange: function() {
                this.props.onUserInput(
                    this.refs.filterTextInput.getDOMNode().value
                );
            },
            render: function() {
                return (
                    <div className="row ">
                      <div className="col-lg-4 col-lg-offset-4">
                        <form onSubmit={this.handleSubmit}>
                          <input ref="filterTextInput" value={this.props.filterText} onChange={this.handleChange} type="search" className="form-control" placeholder="Search for episode" />
                        </form>
                      </div>
                    </div>
                );
            }
        });

        var FilterableEpisodeTable = React.createClass({
            getInitialState: function() {
                return {
                    filterText: ''
                };
            },

            handleUserInput: function(filterText) {
                this.setState({
                    filterText: filterText
                });
            },

            render: function() {
                return (
                    <div className="spacer">
                        <SearchBar onUserInput={this.handleUserInput} filterText={this.state.filterText} />
                        <EpisodeTable filterText={this.state.filterText} episodes={this.props.episodes} />
                    </div>
                );
            }
        });


        var episodes = [{
              title : "Angular with Yeoman",
              link: 'http://tagtree.tv/angular-with-yeoman',
              date: new Date(2013,11,14)
          },{
              title : "Using D3 with Rickshaw and Angular",
              link: 'http://tagtree.tv/d3-with-rickshaw-and-angular',
              date: new Date(2013,11,30),
          },{
              title : "Canvas with paper.js",
              link: 'http://tagtree.tv/canvas-with-paper-js',
              date: new Date(2014,0,29),
          },{
              title : "Express.js middleware",
              link: 'http://tagtree.tv/expressjs-middleware',
              date: new Date(2014,1,10),
          },{
              title : "MEAN stack - episode 1",
              link: 'http://tagtree.tv/mean-stack-episode1',
              date: new Date(2014,1,18),
          },{
              title : "ES6 - episode 1",
              link: 'http://tagtree.tv/ecmascript-6-episode-1',
              date: new Date(2014,2,7),
          },{
              title : "MEAN stack - episode 2",
              link: 'http://tagtree.tv/mean-stack-episode2',
              date: new Date(2014,2,10),
          },{
              title : "ES6 - episode 2",
              link: 'http://tagtree.tv/ecmascript-6-episode-2',
              date: new Date(2014,2,18),
          },{
              title : "ES6 - episode 3",
              link: 'http://tagtree.tv/ecmascript-6-episode-3',
              date: new Date(2014,2,24),
          },{
              title : "ES6 - episode 4",
              link: 'http://tagtree.tv/ecmascript-6-episode-4',
              date: new Date(2014,3,5),
          }
        ];

        React.renderComponent(<FilterableEpisodeTable episodes={episodes} />, document.getElementById('container'));

        </script>
    </body>
</html>